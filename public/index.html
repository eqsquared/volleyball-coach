<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicons/android-chrome-512x512.png">
    
    <title>Volleyball Coach - Position Training</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Drag and drop polyfill for mobile devices -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@2.0.0-rc.1/drag-drop-touch.min.js"></script> -->
</head>
<body>
    <div class="app-container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle menu">
                <i data-lucide="menu"></i>
            </button>
            <div class="mobile-header-logo">
                <img src="favicons/android-chrome-512x512.png" alt="Volleyball Coach" class="mobile-logo-img">
            </div>
            <div class="mobile-header-spacer"></div>
        </header>
        
        <!-- Drawer Overlay -->
        <div class="drawer-overlay" id="drawer-overlay"></div>
        
        <div class="main-content">
            <!-- Sidebar with Accordions -->
            <div class="sidebar" id="sidebar">

                <!-- Accordion: Players -->
                <div class="accordion" data-accordion="players">
                    <div class="accordion-header">
                        <h3><i data-lucide="users"></i> Players</h3>
                        <i data-lucide="chevron-down" class="accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="add-player-form">
                            <input type="text" id="player-name" placeholder="Name">
                            <input type="number" id="jersey-number" placeholder="#" min="1" max="99" class="jersey-input">
                            <button id="add-player-btn">+ Add</button>
                        </div>
                        <div class="lineup-list" id="lineup-list">
                            <!-- Players will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Accordion: Positions -->
                <div class="accordion" data-accordion="positions">
                    <div class="accordion-header">
                        <h3><i data-lucide="map-pin"></i> Positions</h3>
                        <i data-lucide="chevron-down" class="accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="search-filter-bar">
                            <div class="search-input-wrapper">
                                <input type="text" id="position-search-input" placeholder="Search positions...">
                                <button id="tag-filter-btn" class="tag-filter-btn" title="Filter by tags">
                                    <i data-lucide="tag"></i>
                                </button>
                            </div>
                            <div class="selected-tags" id="selected-tags-container">
                                <!-- Selected tags will appear here -->
                            </div>
                        </div>
                        <button id="new-position-btn" class="new-position-btn">+ New Position</button>
                        <div class="items-list" id="positions-list">
                            <!-- Positions will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Accordion: Scenarios -->
                <div class="accordion" data-accordion="scenarios">
                    <div class="accordion-header">
                        <h3><i data-lucide="film"></i> Scenarios</h3>
                        <i data-lucide="chevron-down" class="accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="search-filter-bar">
                            <div class="search-input-wrapper">
                                <input type="text" id="scenario-search-input" placeholder="Search scenarios...">
                                <button id="scenario-tag-filter-btn" class="tag-filter-btn" title="Filter by tags">
                                    <i data-lucide="tag"></i>
                                </button>
                            </div>
                            <div class="selected-tags" id="selected-scenario-tags-container">
                                <!-- Selected tags will appear here -->
                            </div>
                        </div>
                        <div class="items-list" id="scenarios-list">
                            <!-- Scenarios will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Accordion: Sequences -->
                <div class="accordion" data-accordion="sequences">
                    <div class="accordion-header">
                        <h3><i data-lucide="list-ordered"></i> Sequences</h3>
                        <i data-lucide="chevron-down" class="accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="create-form">
                            <input type="text" id="sequence-name-input" placeholder="Sequence name">
                            <button id="create-sequence-btn">Create Sequence</button>
                        </div>
                        <div class="items-list" id="sequences-list">
                            <!-- Sequences will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Accordion: Data Management -->
                <div class="accordion" data-accordion="data-management">
                    <div class="accordion-header">
                        <h3><i data-lucide="database"></i> Data Management</h3>
                        <i data-lucide="chevron-down" class="accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="data-buttons">
                            <button id="export-json-btn">Export JSON</button>
                            <button id="export-xml-btn">Export XML</button>
                            <button id="import-btn">Import File</button>
                            <input type="file" id="import-file" accept=".json,.xml" class="hidden">
                        </div>
                        <p class="data-info" id="file-status">Data is automatically saved to data.json file.</p>
                    </div>
                </div>
            </div>

            <!-- Court Section -->
            <div class="court-section">
                <!-- Top Bar: State Indicator (Left) and Animation Buttons (Right) -->
                <div class="court-top-bar">
                    <!-- State Indicator (Top Left) -->
                    <div class="state-indicator" id="state-indicator">
                        <div class="current-item hidden" id="current-item-display">
                            <span class="item-badge" id="current-item-badge"></span>
                            <span class="item-name" id="current-item-name"></span>
                        </div>
                        <div class="modified-indicator hidden" id="modified-indicator">
                            <span class="badge">Modified</span>
                            <button id="save-btn" class="btn-save">Save</button>
                            <button id="save-as-btn" class="btn-save-as">Save As</button>
                            <button id="discard-btn" class="btn-discard">Discard</button>
                        </div>
                    </div>

                    <!-- Animation Buttons (Top Right) -->
                    <div class="animation-buttons hidden" id="animation-buttons">
                        <!-- Scenario buttons -->
                        <button id="play-animation-btn"><i data-lucide="play"></i> <span>Play</span></button>
                        <button id="refresh-position-btn"><i data-lucide="refresh-cw"></i> <span>Reset</span></button>
                        <button id="clear-scenario-btn" title="Clear scenario"><i data-lucide="x-circle"></i> <span>Clear</span></button>
                        
                        <!-- Sequence buttons -->
                        <button id="sequence-play-btn" class="hidden"><i data-lucide="play"></i> <span>Play</span></button>
                        <button id="sequence-prev-btn" class="hidden"><i data-lucide="skip-back"></i> <span>Prev</span></button>
                        <button id="sequence-next-btn" class="hidden"><i data-lucide="skip-forward"></i> <span>Next</span></button>
                        <div class="sequence-progress hidden" id="sequence-progress">
                            <span id="sequence-progress-text">Position 1 of 3</span>
                        </div>
                    </div>
                </div>

                <!-- Court Container (Centered) -->
                <div class="court-container">
                    <div class="court" id="court">
                        <!-- Net -->
                        <div class="net"></div>
                        <!-- 10ft line (attack line) -->
                        <div class="attack-line"></div>
                        <!-- Player positions will be added here -->
                    </div>
                </div>

                <!-- Position Drop Zones (Below Court) - for scenarios -->
                <div class="position-drop-zones-container" id="position-drop-zones-container">
                    <div class="timeline-label" id="drop-zones-label">Scenario</div>
                    <div class="position-drop-zones" id="position-drop-zones">
                    <div class="drop-zone" id="start-position-zone" data-zone-type="start">
                        <div class="drop-zone-label">Start Position</div>
                        <div class="drop-zone-content" id="start-position-content">
                            <span class="drop-zone-placeholder">Drag position here</span>
                        </div>
                        <button class="drop-zone-clear hidden" id="clear-start-position" title="Clear">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="drop-zone" id="end-position-zone" data-zone-type="end">
                        <div class="drop-zone-label">End Position</div>
                        <div class="drop-zone-content" id="end-position-content">
                            <span class="drop-zone-placeholder">Drag position here</span>
                        </div>
                        <button class="drop-zone-clear hidden" id="clear-end-position" title="Clear">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    </div>
                </div>
                
                <!-- Sequence Timeline (Below Court) - for sequences -->
                <div class="sequence-timeline hidden" id="sequence-timeline">
                    <div class="timeline-label">Sequence Timeline</div>
                    <div class="timeline-container" id="timeline-container">
                        <div class="timeline-placeholder">Drag positions or scenarios here to build your sequence</div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Positions Bucket (Bottom of Screen) -->
            <div class="mobile-positions-bucket hidden" id="mobile-positions-bucket">
                <div class="mobile-positions-header">
                    <h3>Positions</h3>
                </div>
                <div class="mobile-positions-list" id="mobile-positions-list">
                    <!-- Positions will be added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title"></h3>
                <button class="modal-close" id="modal-close">Ã—</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <!-- Auth Modal (Login/Register) -->
    <div id="auth-modal-overlay" class="auth-modal-overlay hidden">
        <div class="auth-modal-container">
            <div class="auth-modal-header">
                <h2>Volleyball Coach</h2>
                <p>Please log in or create an account to continue</p>
            </div>
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>
            <div class="auth-content">
                <!-- Login Form -->
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <div class="auth-error" id="login-error"></div>
                    <button type="submit" class="auth-submit-btn">Log In</button>
                </form>
                
                <!-- Register Form -->
                <form id="register-form" class="auth-form hidden">
                    <div class="form-group">
                        <label for="register-first-name">First Name</label>
                        <input type="text" id="register-first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="register-last-name">Last Name</label>
                        <input type="text" id="register-last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" required minlength="6">
                        <small>Must be at least 6 characters</small>
                    </div>
                    <div class="form-group">
                        <label for="register-role">Role</label>
                        <select id="register-role" required>
                            <option value="">Select a role</option>
                            <option value="coach">Coach</option>
                            <option value="assistant coach">Assistant Coach</option>
                            <option value="player">Player</option>
                        </select>
                    </div>
                    <div class="auth-error" id="register-error"></div>
                    <button type="submit" class="auth-submit-btn">Register</button>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
