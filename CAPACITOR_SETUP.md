# Capacitor Setup Guide

This guide explains how to set up and use Capacitor to build native iOS and Android apps from your Volleyball Coach web application.

## Prerequisites

1. **Node.js** (>=16.0.0) and npm (>=8.0.0)
2. **iOS Development**: Xcode (macOS only)
3. **Android Development**: Android Studio (optional, for Android builds)

## Installation

1. Install dependencies:
```bash
npm install
```

This will install:
- `@capacitor/core` - Core Capacitor runtime
- `@capacitor/cli` - Capacitor CLI tools
- `@capacitor/app` - App lifecycle and state management
- `@capacitor/preferences` - Native key-value storage
- `@capacitor/ios` - iOS platform support

## Development Workflow

### Web Development (Local Testing)

For local web development, continue using:

```bash
npm start
```

This starts the Express server on `http://localhost:8000`. The app will use API mode, connecting to your MongoDB database via the Express server.

### Native App Development

#### 1. Sync Capacitor (First Time Setup)

After making changes to your web app, sync them to the native projects:

```bash
npm run sync
```

Or specifically for iOS:

```bash
npm run sync:ios
```

This command:
- Copies your `public/` directory to the native app
- Updates native project files
- Installs any native dependencies

#### 2. Open in Xcode (iOS)

```bash
npm run open:ios
```

This opens the iOS project in Xcode, where you can:
- Run the app on a simulator
- Run the app on a physical device
- Build and archive for App Store distribution

#### 3. Build for Production

When ready to build for production:

1. **Sync your latest changes:**
   ```bash
   npm run sync:ios
   ```

2. **Open in Xcode:**
   ```bash
   npm run open:ios
   ```

3. **In Xcode:**
   - Select your target device/simulator
   - Product → Archive (for App Store)
   - Or Product → Run (for testing)

## How It Works

### Environment Detection

The app automatically detects whether it's running in:
- **Web mode**: Uses Express API endpoints (`/api/*`) to connect to MongoDB
- **Native mode**: Uses Capacitor Preferences for local storage (offline-first)

### Data Storage

- **Web mode**: Data is stored in MongoDB via Express API
- **Native mode**: Data is stored locally using Capacitor Preferences (persistent, native storage)

### Switching Between Modes

The app automatically switches modes based on the environment:
- If `window.Capacitor` is available → Native mode (local storage)
- Otherwise → Web mode (API calls)

No code changes needed - it's all handled automatically!

## Project Structure

```
volleyball-coach/
├── public/                 # Web app files (served in both web and native)
│   ├── js/
│   │   ├── environment.js  # Environment detection
│   │   ├── capacitor-init.js  # Capacitor initialization
│   │   └── ...
│   ├── db.js              # Hybrid database layer (API or local storage)
│   └── index.html
├── ios/                   # iOS native project (generated by Capacitor)
├── capacitor.config.js    # Capacitor configuration
└── package.json           # Includes Capacitor scripts
```

## Available Scripts

- `npm start` - Start Express server for web development
- `npm run sync` - Sync web app to all native platforms
- `npm run sync:ios` - Sync to iOS only
- `npm run open:ios` - Open iOS project in Xcode
- `npm run copy` - Copy web files to native projects
- `npm run copy:ios` - Copy to iOS only

## Configuration

Capacitor configuration is in `capacitor.config.js`:

- `appId`: Your app's unique identifier (change if needed)
- `appName`: Display name of your app
- `webDir`: Directory containing your web app (`public/`)

## Troubleshooting

### "Cannot connect to server" in Web Mode

Make sure the Express server is running:
```bash
npm start
```

### Changes Not Appearing in Native App

After making changes to files in `public/`, sync them:
```bash
npm run sync:ios
```

### Capacitor Not Detected

In native mode, Capacitor should be automatically available. If you see errors:
1. Make sure you've run `npm install`
2. Run `npm run sync` to update native projects
3. Rebuild the app in Xcode

## Next Steps

1. **Test locally**: Continue using `npm start` for web development
2. **Test natively**: Run `npm run sync:ios && npm run open:ios` to test on iOS
3. **Customize**: Update `capacitor.config.js` with your app details
4. **Build**: Use Xcode to build and distribute your app

## Notes

- The app works offline in native mode (uses local storage)
- In web mode, it requires the Express server and MongoDB
- Data formats are compatible between both modes
- You can export/import data to migrate between modes
